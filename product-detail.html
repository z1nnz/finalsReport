<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品詳情頁</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="CSS/style.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="JS/main.js" defer></script>
  <script src="JS/products.js"></script>
</head>
<body>

  <!-- 導覽列 -->
  <nav class="navbar navbar-expand-lg navbar-dark  sticky-top " >
    <a class="navbar-brand " id="nav_title" href="index.html">GO！起來團購網</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">       
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active"><a class="nav-link"id ="nav_text" href="index.html">首頁</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id ="nav_text" href="products.html" id="productDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            團購商品來看這
          </a>
          <div class="dropdown-menu" aria-labelledby="productDropdown">
            <a class="dropdown-item" href="products.html#household">生活用品</a>
            <a class="dropdown-item" href="products.html#food">美食</a>
            <a class="dropdown-item" href="products.html#coupon">餐券</a>
          </div>
        </li>
      </ul>
      <a href="wishlist.html" id ="nav_botton" class="btn btn-outline-warning mr-2" style="border-radius: 15px; border-color: #d4a373; ">❤️ 收藏清單</a>
      <a href="cart.html" id ="nav_botton" class="btn btn-outline-light mr-2" style="border-radius: 15px; border-color: #d4a373; ">🛒 購物車</a>
      <a href="member.html" id ="nav_botton" class="btn btn-outline-light mr-2" style="border-radius: 15px; border-color: #d4a373; ">👤 會員中心</a>
      <a href="#" id ="nav_botton" class="btn btn-outline-light" data-toggle="modal" data-target="#authModal" style="border-radius: 15px; border-color: #d4a373; ">登入 / 註冊</a>
    </div>
  </nav>
  <!-- 登入 / 註冊 Modal -->
  <div class="modal fade" id="authModal" tabindex="-1" role="dialog" aria-labelledby="authModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="authModalLabel">會員登入 / 註冊</h5>
          <button type="button" class="close text-light" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true" style="color: black;">&times;</span>
          </button>
        </div>
        <div class="modal-body" >
          <!-- Nav tabs -->
          <ul class="nav nav-tabs mb-3" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#loginTab" role="tab" style="color: #03045e;font-size: 15px;">登入</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#registerTab" role="tab" style="color: #03045e; font-size: 15px;">註冊</a>
            </li>
          </ul>
  
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="loginTab" role="tabpanel">
              <form>
                <div class="form-group">
                  <label for="loginEmail">帳號</label>
                  <input type="email" class="form-control" id="loginEmail" placeholder="輸入Email">
                </div>
                <div class="form-group">
                  <label for="loginPassword">密碼</label>
                  <input type="password" class="form-control" id="loginPassword" placeholder="輸入密碼">
                </div>
                <button type="submit" class="btn  btn-block" style="background-color: #a0c4ff;">登入</button>
              </form>
            </div>
            <div class="tab-pane" id="registerTab" role="tabpanel">
              <form>
                <div class="form-group">
                  <label for="registerEmail">帳號</label>
                  <input type="email" class="form-control" id="registerEmail" placeholder="輸入Email">
                </div>
                <div class="form-group">
                  <label for="registerPassword">密碼</label>
                  <input type="password" class="form-control" id="registerPassword" placeholder="輸入密碼">
                </div>
                <div class="form-group">
                  <label for="confirmPassword">確認密碼</label>
                  <input type="password" class="form-control" id="confirmPassword" placeholder="再次輸入密碼">
                </div>
                <button type="submit" class="btn  btn-block" style="background-color: #a0c4ff;">註冊</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 商品詳情內容 -->
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-6">
        <img id="product-image" src="" class="img-fluid mb-3" alt="商品圖">
      </div>
      <div class="col-md-6 ">
        <h2 id="product-name"></h2>
        <p id="product-price" class="h4" style="color: #9b2226;"></p>
        <p id="product-description"></p>

        <label for="quantity">選擇數量：</label>
        <input type="number" id="quantity" class="form-control w-25 mb-3" value="1" min="1">

        <button class="btn btn-outline-warning btn-block mb-3" onclick="addToCart()">加入購物車</button>
        <button id="wishlist-btn" class="btn btn-outline-danger btn-block mb-3">❤️ 收藏</button>

        <p>商品評分：</p>
        <div id="star-rating">
          ★★★★★
        </div>
      </div>
    </div>

    <hr class="bg-secondary">

    <!-- 使用者評價與留言區 -->
    <div >
      <h4>新增評論</h4>
      <form id="review-form" class="mb-4">
        <div class="form-group">
          <label for="reviewer">暱稱</label>
          <input type="text" class="form-control" id="reviewer" required>
        </div>
        <div class="form-group">
          <label for="rating">評分</label>
          <select class="form-control w-25" id="rating" required>
            <option value="5">★★★★★</option>
            <option value="4">★★★★☆</option>
            <option value="3">★★★☆☆</option>
            <option value="2">★★☆☆☆</option>
            <option value="1">★☆☆☆☆</option>
          </select>
        </div>
        <div class="form-group">
          <label for="comment">留言</label>
          <textarea class="form-control" id="comment" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-outline-warning">送出</button>
      </form>

      <h5>平均評分：<span id="average-rating">尚無評分</span></h5>
      <div id="reviews-container"></div>
    </div>

    <hr class="bg-secondary">

    <!-- 評論區 -->
    <div >
      <h4>顧客評論</h4>
      <div class=" mb-3" style="height: 50px;border: 1px black solid; background-color: #e3d5ca;padding: 10px 5px;">
        <strong>使用者A：</strong> 超讚的商品，回購好幾次了！★★★★★
      </div>
      <div class=" mb-3" style="height: 50px;border: 1px black solid; background-color: #e3d5ca; padding: 10px 5px;">
        <strong>使用者B：</strong> 品質很好，送貨也很快，推薦！★★★★☆
      </div>
    </div>
  </div>

  <!-- 頁尾 -->
  <footer class="text-center py-3" id="footer_all" >
    GO！起來團購網 &copy; 2025 - 所有權利保留
  </footer>

  <script>
    function addToCart() {
        const product = {
            name: document.getElementById("product-name").textContent,
            price: parseInt(document.getElementById("product-price").dataset.price),
            quantity: parseInt(document.getElementById("quantity").value),
        };

        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        const existing = cart.find(item => item.name === product.name);
        if (existing) {
            existing.quantity += product.quantity;
        } else {
            cart.push(product);
        }

        localStorage.setItem("cart", JSON.stringify(cart));
        alert(`已將 ${product.quantity} 件商品加入購物車！`);
    }
  </script>

  <script>
    window.onload = () => {
      const urlParams = new URLSearchParams(window.location.search);
      const idParam   = urlParams.get("id") || urlParams.get("product");
      const nameParam = urlParams.get("name");
      const product = products.find(p =>
          (idParam   && p.id   === parseInt(idParam)) ||
          (nameParam && p.name === decodeURIComponent(nameParam))
      );

      if (product) {
        document.getElementById("product-name").textContent = product.name;
        document.getElementById("product-price").innerHTML = 
          `團購價 NT$${product.price} <del class="text-muted ml-3">原價 NT$${product.originalPrice}</del>`;
        document.getElementById("product-price").dataset.price = product.price;
        document.getElementById("product-description").textContent = product.description;
        document.getElementById("product-image").src = product.image;
        document.getElementById("product-image").alt = product.name;
        // 收藏按鈕功能
        document.getElementById("wishlist-btn").addEventListener("click", () => {
          const wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];
          const exists = wishlist.some(item => item.name === product.name);
          if (!exists) {
            wishlist.push(product);
            localStorage.setItem("wishlist", JSON.stringify(wishlist));
            alert(`已收藏 ${product.name}！`);
          } else {
            alert(`${product.name} 已在收藏清單中。`);
          }
        });
      }
    };

  </script>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const urlParams = new URLSearchParams(window.location.search);
    const idParam = urlParams.get("id") || urlParams.get("product");
    const productId = parseInt(idParam);

    const form = document.getElementById("review-form");
    const reviewsContainer = document.getElementById("reviews-container");
    const averageRatingDisplay = document.getElementById("average-rating");

    function renderReviews() {
      const reviews = JSON.parse(localStorage.getItem("reviews_" + productId)) || [];
      reviewsContainer.innerHTML = "";
      if (reviews.length === 0) {
        reviewsContainer.innerHTML = "<p class='text-muted'>尚無留言</p>";
        averageRatingDisplay.textContent = "尚無評分";
        return;
      }

      let totalRating = 0;
      reviews.forEach(r => {
        totalRating += r.rating;
        const stars = "★★★★★☆☆☆☆☆".slice(5 - r.rating, 10 - r.rating);
        const div = document.createElement("div");
        div.className = "border p-3 mb-2";
        div.innerHTML = `<strong>${r.name}</strong>（${r.date}）<br>${stars}<br>${r.comment}`;
        reviewsContainer.appendChild(div);
      });
      const avg = (totalRating / reviews.length).toFixed(1);
      averageRatingDisplay.textContent = `${avg} 顆星 (${reviews.length} 筆)`;
    }

    form.addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("reviewer").value.trim();
      const rating = parseInt(document.getElementById("rating").value);
      const comment = document.getElementById("comment").value.trim();
      if (!name || !comment || !rating) return;

      const review = {
        name,
        rating,
        comment,
        date: new Date().toLocaleString()
      };
      const reviews = JSON.parse(localStorage.getItem("reviews_" + productId)) || [];
      reviews.push(review);
      localStorage.setItem("reviews_" + productId, JSON.stringify(reviews));

      form.reset();
      renderReviews();
    });

    renderReviews();
  });
</script>
</body>
</html>