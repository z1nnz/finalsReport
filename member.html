<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœƒå“¡ä¸­å¿ƒ</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="CSS/style.css">
  <script src="JS/main.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const orderList = document.getElementById('orderList');
      const totalEl = document.getElementById('orderTotal');
      const clearBtn = document.getElementById('clearOrders');

      let orders = JSON.parse(localStorage.getItem('orders') || '[]');

      if (orders.length === 0) {
        orderList.innerHTML = "<div >å°šç„¡æ¶ˆè²»ç´€éŒ„</div>";
        totalEl.textContent = "ç¸½æ¶ˆè²»é‡‘é¡ï¼šNT$0";
        return;
      }

      let grandTotal = 0;

      orders.slice().reverse().forEach((order, index) => {
        let subtotal = 0;
        const wrapper = document.createElement('div');
        wrapper.className = 'mb-3 p-2 border border-light rounded';

        // å–®ç­†åˆªé™¤æŒ‰éˆ•
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn btn-sm btn-danger mb-1';
        deleteBtn.textContent = 'ğŸ—‘ï¸ åˆªé™¤';
        deleteBtn.addEventListener('click', () => {
          if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç­†è¨‚å–®ï¼Ÿ')) {
            orders.splice(orders.length - 1 - index, 1);
            localStorage.setItem('orders', JSON.stringify(orders));
            location.reload();
          }
        });
        // æ–°å¢è©•è«–æŒ‰éˆ•
        const commentBtn = document.createElement('button');
        commentBtn.className = 'btn btn-sm btn-info';
        commentBtn.textContent = 'ğŸ’¬ è©•è«–';
        // æŒ‰éˆ•ç¾¤çµ„å®¹å™¨
        const btnGroup = document.createElement('div');
        btnGroup.className = 'd-flex flex-column align-items-end gap-1';
        btnGroup.appendChild(deleteBtn);
        btnGroup.appendChild(commentBtn);
        wrapper.appendChild(btnGroup);

        const title = document.createElement('div');
        title.className = 'font-weight-bold';
        title.textContent = `ğŸ§¾ è¨‚å–®æ™‚é–“ï¼š${order.date}`;
        wrapper.appendChild(title);

        const ul = document.createElement('ul');
        ul.className = 'list-group list-group-flush';

        order.items.forEach(item => {
          const qty = item.quantity || 1;
          const cost = item.price * qty;
          subtotal += cost;

          const li = document.createElement('li');
          li.className = 'list-group-item bg-secondary text-light d-flex align-items-center';
          li.innerHTML = `<span class="mr-2">${item.name} x${qty}</span><span class="ml-auto">NT$${cost}</span>`;
          ul.appendChild(li);
        });

        const subtotalEl = document.createElement('div');
        subtotalEl.className = 'text-right mt-2 text-info';
        subtotalEl.textContent = `å°è¨ˆï¼šNT$${subtotal}`;
        grandTotal += subtotal;

        // å°‡å•†å“æ¸…å–®èˆ‡å³å´æŒ‰éˆ•åŒ…æˆ Flex å®¹å™¨ï¼Œåˆ†ç‚ºå·¦å³å…©å´
        const rowWrapper = document.createElement('div');
        rowWrapper.className = 'd-flex justify-content-between align-items-start';

        const leftSide = document.createElement('div');
        leftSide.appendChild(ul);

        const rightSide = document.createElement('div');
        rightSide.className = 'text-right';
        rightSide.appendChild(btnGroup);
        rightSide.appendChild(subtotalEl);

        rowWrapper.appendChild(leftSide);
        rowWrapper.appendChild(rightSide);
        wrapper.appendChild(rowWrapper);


        // å»ºç«‹éš±è—çš„è©•è«–è¼¸å…¥å€å¡Š
        const commentArea = document.createElement('div');
        commentArea.className = 'mt-2 p-2 bg-dark rounded';
        commentArea.style.display = 'none';

        // æ˜Ÿç­‰é¸å–®
        const starLabel = document.createElement('label');
        starLabel.textContent = 'æ˜Ÿç­‰ï¼š';
        starLabel.className = 'mr-2 text-light';
        commentArea.appendChild(starLabel);

        const starSelect = document.createElement('select');
        starSelect.className = 'form-control form-control-sm d-inline-block w-auto mr-3';
        for (let i = 5; i >= 1; i--) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = 'â˜…'.repeat(i) + 'â˜†'.repeat(5 - i);
          starSelect.appendChild(option);
        }
        commentArea.appendChild(starSelect);

        // æ–‡å­—è¼¸å…¥æ¬„ä½
        const commentInput = document.createElement('input');
        commentInput.type = 'text';
        commentInput.className = 'form-control form-control-sm d-inline-block w-50 mr-3';
        commentInput.placeholder = 'è«‹è¼¸å…¥è©•è«–å…§å®¹';
        commentArea.appendChild(commentInput);

        // é€å‡ºæŒ‰éˆ•
        const submitBtn = document.createElement('button');
        submitBtn.className = 'btn btn-sm btn-success';
        submitBtn.textContent = 'é€å‡º';
        commentArea.appendChild(submitBtn);

        wrapper.appendChild(commentArea);

        commentBtn.addEventListener('click', () => {
          commentArea.style.display = commentArea.style.display === 'none' ? 'block' : 'none';
        });

        submitBtn.addEventListener('click', () => {
          const stars = starSelect.value;
          const text = commentInput.value.trim();
          if (text === '') {
            alert('è«‹è¼¸å…¥è©•è«–å…§å®¹');
            return;
          }
          // æ–°å¢è©•è«–åˆ°è©•è«–å€å¡Š
          const commentsList = document.getElementById('commentsList');
          if (!commentsList) return;
          const li = document.createElement('li');
          li.className = 'list-group-item bg-dark text-light';
          li.textContent = `${order.date}ï¼š${'â˜…'.repeat(stars)}${'â˜†'.repeat(5 - stars)} - ${text}`;
          commentsList.appendChild(li);

          // æ¸…ç©ºè¼¸å…¥æ¬„ä¸¦éš±è—è¼¸å…¥å€
          commentInput.value = '';
          starSelect.value = 5;
          commentArea.style.display = 'none';
        });

        orderList.appendChild(wrapper);
      });

      totalEl.textContent = `ç¸½æ¶ˆè²»é‡‘é¡ï¼šNT$${grandTotal}`;

    });
    </script>
</head>
<body >

  <nav class="navbar navbar-expand-lg navbar-dark  sticky-top">
    <a class="navbar-brand" id="nav_title" href="index.html">GOï¼èµ·ä¾†åœ˜è³¼ç¶²</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item"><a class="nav-link" id ="nav_text"href="index.html">é¦–é </a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id ="nav_text" href="products.html" id="productDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            åœ˜è³¼å•†å“ä¾†çœ‹é€™
          </a>
          <div class="dropdown-menu" aria-labelledby="productDropdown">
            <a class="dropdown-item"  href="products.html#household">ç”Ÿæ´»ç”¨å“</a>
            <a class="dropdown-item"  href="products.html#food">ç¾é£Ÿ</a>
            <a class="dropdown-item"  href="products.html#coupon">é¤åˆ¸</a>
          </div>
        </li>
      </ul>
      <div class="ml-auto">
        <a href="wishlist.html" id ="nav_botton"  class="btn btn-outline-warning mr-2" >â¤ï¸ æ”¶è—æ¸…å–®</a>
        <a href="cart.html" id="nav_botton"  class="btn btn-outline-light mr-2" >ğŸ›’ è³¼ç‰©è»Š</a>
        <a href="member.html" id ="nav_botton"class="btn btn-outline-light mr-2" >ğŸ‘¤ æœƒå“¡ä¸­å¿ƒ</a>
      </div>
    </div>
  </nav>
  <div class="container py-5">
    <h2 class="text-info mb-4">ğŸ‘¤ æœƒå“¡è³‡æ–™</h2>
    <div class="card  mb-4 member_card">
      <div class="card-body">
        <h5 class="member_title">åŸºæœ¬è³‡æ–™</h5>
        <p class="member_content"><strong>å§“åï¼š</strong> ç‹å°æ˜</p>
        <p class="member_content"><strong>Emailï¼š</strong> example@mail.com</p>
        <p class="member_content"><strong>æœƒå“¡è¨»å†Šæ—¥æœŸï¼š</strong> 2024-11-05</p>
      </div>
    </div>

    <div class="card member_card mb-4">
      <div class="card-body">
        <h5 class="member_title">æ­·å²æ¶ˆè²»ç´€éŒ„</h5>
        <div id="orderList"  class="member_content" style="padding: 10px 0px;"></div>
        <h5 id="orderTotal" style="color: red;font-weight: bold;">ç¸½æ¶ˆè²»é‡‘é¡ï¼šNT$0</h5>
      </div>
    </div>

    <div class="card member_card">
      <div class="card-body">
        <h5 class="member_title">è©•è«–èˆ‡è©•åˆ†ç´€éŒ„</h5>
        <ul id="commentsList" class="list-group list-group-flush">
          <li class="list-group-item " style="background-color: #fffffc; font-size: 18px;">æ´—è¡£ç²¾ï¼šâ˜…â˜…â˜…â˜…â˜… - å®¶åº­ä¸»å©¦çš„æœ€æ„›ï¼Œå›è³¼+1ï¼</li>
          <li class="list-group-item " style="background-color: #fffffc; font-size: 18px;">æœå‹™å“è³ªï¼šâ˜…â˜…â˜…â˜…â˜† - åº—å®¶è¦ªåˆ‡ï¼Œæœå‹™å‘¨åˆ°ï¼</li>
          <li class="list-group-item " style="background-color: #fffffc; font-size: 18px;">åƒ¹æ ¼ï¼šâ˜…â˜…â˜…â˜…â˜† - åƒ¹æ ¼åˆç†ï¼Œè²·å¤šæœ‰æ›´å¤šå„ªæƒ å–”ï¼</li>
          <li class="list-group-item " style="background-color: #fffffc; font-size: 18px;">åº—å®¶ç¸½è©•ï¼šâ˜…â˜…â˜…â˜…â˜… - æ¨å»£+1ï¼Œå®£å‚³+1ï¼Œå¤§å®¶æ”¯æŒèµ·ä¾†ï¼</li>

        </ul>
      </div>
    </div>
  </div>
  <!-- æŒ‰éˆ• HTMLï¼Œå¯ç›´æ¥æ”¾åœ¨ <body> æœ€åº• -->
    <button id="backToTop" title="å›åˆ°é ‚ç«¯">â†‘</button>
    <footer class="text-center py-3" id="footer_all" >
      GOï¼èµ·ä¾†åœ˜è³¼ç¶² &copy; 2025 - æ‰€æœ‰æ¬Šåˆ©ä¿ç•™
    </footer>
  </body>
</html>